<div class='viewport'></div>
<header>
    <div class="container2">
      <a class ='nav2' href="/">Home</a>
      <a class ='nav2' href="/joints">List of  Restaurants</a>
      <a class ='nav2' href="/burgers">All Posts</a>
      <a class ='nav2' href="/about">About Bok</a>
</div>
</header>

<!-- <form action="/addImage" method="post">
  <input name="file" type="file">
  <br>
  <input type="submit">
</form> -->

<input type="file" id="file-input">
<p id="status">Please select a file</p>
<!-- <img id="preview" src="/images/default.png"> -->

<br>
<h4 class='new-burger'>Another Day Another Burger:</h4>
<form class='new-burger' action='/joints' method='POST'>
  <input type="hidden" id="burger-url" name="burger-url" value="/images/burger.png">
  <!-- <label>Where:</label> -->
  <input type='text' name='restaurantName' placeholder="Restaurant Name"><br><br>
  <!-- <label>When:</label> -->
  <input type='date' name='eatenOn'><br><br>
  <!-- <label>Name of Burger:</label> -->
  <input type='text' name='burgerName' placeholder="Burger Name"><br><br>
  <!-- <label>Type of Meat:</label> -->
  <input type='text' name='typeOfMeat' placeholder="Type Of Meat"><br><br>
  <!-- <label>Rating:</label> -->
  <input type='number' name='rating' placeholder="Rating between 1 and 10"><br><br>
  <!-- <label>Review:</label> -->
  <textarea id='review-new' rows='1' cols='26' type='text' name='review' placeholder="Review Below" wrap='hard'></textarea><br><br>
  <!-- <label>Image:</label> -->
  <input type='url' name='burgerPic' placeholder="Image URL"><br><br>
  <button class='button' type='submit' name='addBurger'>Add New Burger</button>
  <br>
</form>


<script>
(() => {
  document.getElementById("file-input").onchange = () => {
    const files = document.getElementById('file-input').files;
    const file = files[0];
    if(file == null){
      return alert('No file selected.');
    }
    getSignedRequest(file);
  };
})();

function getSignedRequest(file){
  const xhr = new XMLHttpRequest();
  xhr.open('GET', `/sign-s3?file-name=${file.name}&file-type=${file.type}`);
  xhr.onreadystatechange = () => {
    if(xhr.readyState === 4){
      if(xhr.status === 200){
        const response = JSON.parse(xhr.responseText);
        uploadFile(file, response.signedRequest, response.url);
      }
      else{
        alert('Could not get signed URL.');
      }
    }
  };
  xhr.send();
}

function uploadFile(file, signedRequest, url){
  const xhr = new XMLHttpRequest();
  xhr.open('PUT', signedRequest);
  xhr.onreadystatechange = () => {
    if(xhr.readyState === 4){
      if(xhr.status === 200){
        document.getElementById('preview').src = url;
        document.getElementById('avatar-url').value = url;
      }
      else{
        alert('Could not upload file.');
      }
    }
  };
  xhr.send(file);
}
</script>
